# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Test
'on':
  push:
    branches:
      - main
jobs:
  test:
    runs-on: ubuntu-latest
    permissions:
      packages: read
    steps:
      - uses: actions/checkout@v4
      - run: |
          LATEST_VERSION=$(curl -L \
            -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
            -H "Accept: application/vnd.npm.install-v1+json" \
            https://npm.pkg.github.com/@entur/enki \
            | jq -r '.["dist-tags"].latest')
          echo $LATEST_VERSION
          CURRENT_VERSION=$(head -n 1 CURRENT_VERSION)
          if [[ "$LATEST_VERSION" != "$CURRENT_VERSION" ]]; then
            # Update CURRENT_VERSION
            echo $LATEST_VERSION > CURRENT_VERSION
            git add CURRENT_VERSION
            git commit -m 'Updated CURRENT_VERSION'
            git push origin main
          fi